(window.webpackJsonp=window.webpackJsonp||[]).push([[171],{489:function(t,s,a){"use strict";a.r(s);var e=a(17),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"_0-基本介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_0-基本介绍"}},[t._v("#")]),t._v(" 0.基本介绍")]),t._v(" "),s("p",[s("code",[t._v("Python")]),t._v("的强大之处就是它的丰富的开源包，如何开发一个自己的"),s("code",[t._v("Python Package")]),t._v("并将其发布到"),s("code",[t._v("Pypi")]),t._v("呢？在这里记录一下完整的过程。")]),t._v(" "),s("h2",{attrs:{id:"_1-init-py文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-init-py文件"}},[t._v("#")]),t._v(" 1."),s("code",[t._v("__init__.py")]),t._v("文件")]),t._v(" "),s("p",[t._v("python 中的包分成两种，一种是普通包"),s("code",[t._v("regular package")]),t._v("，一种是命名空间包"),s("code",[t._v("namespace package")]),t._v("。")]),t._v(" "),s("h3",{attrs:{id:"_1-1-regular-package"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-regular-package"}},[t._v("#")]),t._v(" 1.1 Regular Package")]),t._v(" "),s("p",[t._v("普通包是指包含一个 "),s("code",[t._v("__init__.py")]),t._v("文件的普通目录,在"),s("code",[t._v("Python 3.2")]),t._v("及之前的版本中一直使用的都是这种包。普通包在导入的时候，会隐式自动调用包中的"),s("code",[t._v("__init__.py")]),t._v("文件，"),s("code",[t._v("__init__.py")]),t._v("中定义的对象，变量都会被限制在包名的命名空间中。")]),t._v(" "),s("p",[t._v("如下形式的包：")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("parent/\n    __init__.py\n    one/\n        __init__.py\n    two/\n        __init__.py\n    three/\n        __init__.py\n")])])]),s("p",[t._v("导入"),s("code",[t._v("parent.one")]),t._v("包时，会自动执行"),s("code",[t._v("parent/__init__.py")]),t._v("和"),s("code",[t._v("parent/one/__init__.py")]),t._v(",导入其他的包时情况也类似。")]),t._v(" "),s("p",[s("strong",[t._v("总结，只需要记住，"),s("code",[t._v("__init__.py")]),t._v("是包导入时最先执行的文件")]),t._v("。")]),t._v(" "),s("p",[s("code",[t._v("_init__.py")]),t._v("中还有一个重要的变量，"),s("code",[t._v("__all__")]),t._v(", 它用来将模块全部导入,也就是支持使用"),s("code",[t._v("from package import *")]),t._v("。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("__all__ "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'os'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sys'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'re'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'urllib'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("h3",{attrs:{id:"_1-2-namespace-package"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-namespace-package"}},[t._v("#")]),t._v(" 1.2 namespace package")]),t._v(" "),s("p",[t._v("命名空间包是指一种特殊的 Python 包，在"),s("code",[t._v("Python 3.3")]),t._v("之后引入，它不包含"),s("code",[t._v("__init__.py")]),t._v("文件，而是由一个或多个不同的目录组成，每个目录都可以包含一个或多个模块。")]),t._v(" "),s("p",[t._v("如有一个命名空间包"),s("code",[t._v("namespace package")]),t._v("包"),s("code",[t._v("nsp")]),t._v("，在目录"),s("code",[t._v("/xx/test_cpp/mypkg/ns")]),t._v("和"),s("code",[t._v("/xx/test_cpp/mypkg/pkg")]),t._v("下各有一个"),s("code",[t._v("nsp")]),t._v("是文件夹，其中分别包含"),s("code",[t._v("nsp1.py")]),t._v("和"),s("code",[t._v("nsp2.py")]),t._v("文件，将路径"),s("code",[t._v("/xx/test_cpp/mypkg/pkg")]),t._v("和"),s("code",[t._v("/xx/test_cpp/mypkg/ns")]),t._v("加入到"),s("code",[t._v("sys.path")]),t._v("中，就可以通过"),s("code",[t._v("import nsp")]),t._v("导入文件夹了。")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# /xx/test_cpp/mypkg/nsa/nsp/nsp1.py")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("print_nsp1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"nsp1"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# /xx/test_cpp/mypkg/nsa/nsp/nsp2.py")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("print_nsp2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"nsp2"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nsys"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("insert"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/xx/test_cpp/mypkg/nsa"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nsys"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("insert"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/xx/test_cpp/mypkg/nsb"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" nsp "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 这里会将两个路径下的nsp合成一个")]),t._v("\nnsp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("print_nsp1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nnsp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("print_nsp2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("注意两个文件夹"),s("code",[t._v("nsp")]),t._v("中都不能包含"),s("code",[t._v("nsp.py")]),t._v(",否则无法导入另外一个。")]),t._v(" "),s("p",[t._v("使用 "),s("code",[t._v("namespace package")]),t._v("命名包时，"),s("code",[t._v("Python")]),t._v("包的搜寻规则为，先搜寻常规的"),s("code",[t._v("package")]),t._v(",再搜寻"),s("code",[t._v("module")]),t._v("文件，然后若搜索到不包含"),s("code",[t._v("__init__.py")]),t._v("文件的目录即"),s("code",[t._v("namespace package")]),t._v("会先记录其路径，待"),s("code",[t._v("sys.path")]),t._v("路径搜寻完毕，若"),s("code",[t._v("regular package")]),t._v("和"),s("code",[t._v("module")]),t._v("中都没有而"),s("code",[t._v("namespace package")]),t._v("中有，就导入"),s("code",[t._v("namespace pakge")]),t._v("。")]),t._v(" "),s("h2",{attrs:{id:"_2-python-package工程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-python-package工程"}},[t._v("#")]),t._v(" 2."),s("code",[t._v("Python Package")]),t._v("工程")]),t._v(" "),s("p",[t._v("一个"),s("code",[t._v("Python Package")]),t._v("工程目录示例：")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("packaging_tutorial/\n├── LICENSE\n├── pyproject.toml\n├── README.md\n├── src/\n│   └── packaging_tutorial/\n│       ├── __init__.py\n│       └── example.py\n└── tests/\n")])])]),s("ul",[s("li",[s("code",[t._v("tests")]),t._v("文件夹中放的是包的单元测试文件")]),t._v(" "),s("li",[s("code",[t._v("pyproject.toml")]),t._v("文件告诉前端打包工具如"),s("code",[t._v("pip/build")]),t._v("等应该使用哪个后端工具如"),s("code",[t._v("setuptools/ Hatchling")]),t._v("等创建工程的发布包。")])]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("build"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("system"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# requires是构建包需要的依赖，不需要手动的安装，前端工具如`pip`等会自动安装")]),t._v("\nrequires "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"setuptools"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"setuptools-scm"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nbuild"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("backend "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"setuptools.build_meta"')]),t._v("\n")])])]),s("p",[t._v("除了指定编译系统之外，还需要为包添加元数据"),s("code",[t._v("metadata")]),t._v("，依赖"),s("code",[t._v("dependencies")]),t._v("和内容"),s("code",[t._v("contents")]),t._v("等，这些内容可以保存在"),s("code",[t._v("pyproject.toml")]),t._v("中，也可单独写到"),s("code",[t._v("setup.py")]),t._v("或者"),s("code",[t._v("setup.cfg")]),t._v("文件中。")]),t._v(" "),s("p",[t._v("如‵setup.py`")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" setuptools "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" setup\n\nsetup"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mypackage'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    version"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0.0.1'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    install_requires"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'requests'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'importlib-metadata; python_version == \"3.8\"'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("或者"),s("code",[t._v("setup.cfg")]),t._v(":")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("metadata"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nname "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mypackage\nversion "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\ninstall_requires "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n    requests\n    importlib"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("metadata"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" python_version "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3.8"')]),t._v("s\n")])])]),s("p",[s("code",[t._v("setup")]),t._v("方法中接受的参数以及含义介绍可以参考"),s("a",{attrs:{href:"https://setuptools.pypa.io/en/latest/references/keywords.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("当"),s("code",[t._v("setup.py/setup.cfg")]),t._v("和"),s("code",[t._v("pyproject.toml")]),t._v("文件有重复配置的内容时，优先使用"),s("code",[t._v("pyproject.toml")]),t._v("中的内容。")]),t._v(" "),s("h3",{attrs:{id:"_2-1-安装及打包并发布到pypi"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-安装及打包并发布到pypi"}},[t._v("#")]),t._v(" 2.1 安装及打包并发布到pypi")]),t._v(" "),s("ul",[s("li",[t._v("开发模式安装本地包")])]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("pip install "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("editable "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),s("ul",[s("li",[t._v("打包包文件,执行完成后,在包路径下生成"),s("code",[t._v("dist")]),t._v("文件夹,其中有打包好的文件")])]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("python "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("m build\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# dist")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ├── mypkgg-0.0.1-py3-none-any.whl")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# └── mypkgg-0.0.1.tar.gz")]),t._v("\n")])])]),s("ul",[s("li",[t._v("将包上传到"),s("code",[t._v("pypi")])])]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1.先安装twine包")]),t._v("\n\npip install twine\n\npython3 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("m twine upload "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("repository testpypi dist"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n")])])]),s("p",[t._v("输入"),s("code",[t._v("pypi")]),t._v("的账号,密码后就可以将包上传到"),s("code",[t._v("pypi")]),t._v("数据库中了,网站上访问显示如下:")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://day-pic-1311699660.cos.ap-nanjing.myqcloud.com/image/pypi-dist1.jpg",alt:""}})]),t._v(" "),s("ul",[s("li",[t._v("如果"),s("code",[t._v("git")]),t._v("仓库是"),s("code",[t._v("package")]),t._v(",还可以通过如下形式安装:")])]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("pip "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-q")]),t._v(" git+https://github.com/lx-r/mypkg.git\n")])])]),s("p",[t._v("在"),s("code",[t._v("python")]),t._v("中，为了避免"),s("code",[t._v("setup.py")]),t._v("的误执行，现在更推荐使用"),s("code",[t._v("setup.cfg")]),t._v("。")]),t._v(" "),s("p",[t._v("上面包中的文件都是手动创建的，其实每个"),s("code",[t._v("Python")]),t._v("包都需要包含上述文件，如此就可以使用模板来创建"),s("code",[t._v("Python")]),t._v("包，常用的工具有"),s("a",{attrs:{href:"https://cookiecutter.readthedocs.io/en/stable/tutorials/tutorial1.html#step-1-generate-a-python-package-project",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("cookiecutter")]),s("OutboundLink")],1),t._v("等。")]),t._v(" "),s("h3",{attrs:{id:"_2-2-将python文件编译成-so"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-将python文件编译成-so"}},[t._v("#")]),t._v(" 2.2 将"),s("code",[t._v("Python")]),t._v("文件编译成"),s("code",[t._v(".so")])]),t._v(" "),s("p",[t._v("需要使用"),s("code",[t._v("cython")])]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("pip install cython\n\n")])])]),s("p",[t._v("在"),s("code",[t._v("setup.py")]),t._v("文件中设置")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" Cython"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Build "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" cythonize\nsetup"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ext_modules "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cythonize"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello1.py"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello2.py"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("执行编译命令：")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("python setup.py build_ext\n\n")])])]),s("p",[t._v("值得注意的是这里打包的"),s("code",[t._v(".so")]),t._v("文件只能适用于同样平台的同样"),s("code",[t._v("python")]),t._v("版本。")]),t._v(" "),s("h2",{attrs:{id:"_3-包的搜索路径"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-包的搜索路径"}},[t._v("#")]),t._v(" 3.包的搜索路径")]),t._v(" "),s("p",[t._v("先搜寻"),s("code",[t._v("built-in")]),t._v("模块"),s("code",[t._v("module")]),t._v(",内建模块在变量"),s("code",[t._v("sys.builtin_module_names")]),t._v("中。")]),t._v(" "),s("p",[t._v("然后到"),s("code",[t._v("sys.path")]),t._v("路径中搜寻,"),s("code",[t._v("sys.path")]),t._v("中包含以下部分，")]),t._v(" "),s("ul",[s("li",[t._v("当前路径")]),t._v(" "),s("li",[t._v("环境变量"),s("code",[t._v("PYTHONPATH")])]),t._v(" "),s("li",[t._v("缺省的安装路径如"),s("code",[t._v("site-packages")])])]),t._v(" "),s("p",[t._v("关于包内的导入方式，当包中包含子包的时候，可以使用绝对路径导入，也可以通过相对路径的方式导入：")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mypkg")]),t._v("\n├── __init__.py\n├── mypkg.py\n└── utils\n    ├── __init__.py\n    └── utils.py\n")])])]),s("p",[t._v("导入方式：")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("utils "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" utils\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# in utils.py")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mypkg "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" xx\n")])])]),s("p",[t._v("值得注意的是，相对路径的引入方式都是基于当前模块的名称"),s("code",[t._v("__name__")]),t._v("的，而在主模块中其"),s("code",[t._v("__name__==__main__")]),t._v("，因此在主模块函数中必须使用绝对导入方式。")]),t._v(" "),s("InArticleAdsense",{attrs:{"data-ad-client":"ca-pub-8685746128991385","data-ad-slot":"2974191661"}}),t._v(" "),s("h3",{attrs:{id:"参考资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),s("blockquote",[s("ul",[s("li",[s("a",{attrs:{href:"https://docs.python.org/3/reference/import.html#packages",target:"_blank",rel:"noopener noreferrer"}},[t._v("1.https://docs.python.org/3/reference/import.html#packages"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://www.cnblogs.com/chaoguo1234/p/9350396.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("2.https://www.cnblogs.com/chaoguo1234/p/9350396.html"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://docs.python.org/3/tutorial/modules.html#the-module-search-path",target:"_blank",rel:"noopener noreferrer"}},[t._v("3.https://docs.python.org/3/tutorial/modules.html#the-module-search-path"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://setuptools.pypa.io/en/latest/userguide/quickstart.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("4.https://setuptools.pypa.io/en/latest/userguide/quickstart.html"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/265462717",target:"_blank",rel:"noopener noreferrer"}},[t._v("5.https://zhuanlan.zhihu.com/p/265462717"),s("OutboundLink")],1)])])])],1)}),[],!1,null,null,null);s.default=n.exports}}]);