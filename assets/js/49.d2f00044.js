(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{368:function(t,s,a){"use strict";a.r(s);var e=a(17),r=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"adaptive-training-sample-selection"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#adaptive-training-sample-selection"}},[t._v("#")]),t._v(" Adaptive Training Sample Selection")]),t._v(" "),s("h2",{attrs:{id:"_1-简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-简介"}},[t._v("#")]),t._v(" 1.简介")]),t._v(" "),s("blockquote",[s("p",[s("a",{attrs:{href:"https://arxiv.org/pdf/1912.02424",target:"_blank",rel:"noopener noreferrer"}},[t._v("论文Bridging the Gap Between Anchor-based and Anchor-free Detection via"),s("br"),t._v("\nAdaptive Training Sample Selection"),s("OutboundLink")],1),s("br"),t._v(" "),s("a",{attrs:{href:"https://github.com/sfzhang15/ATSS",target:"_blank",rel:"noopener noreferrer"}},[t._v("代码https://github.com/sfzhang15/ATSS"),s("OutboundLink")],1)])]),t._v(" "),s("p",[s("code",[t._v("ATSS")]),t._v("是中科院自动化研究所的"),s("code",[t._v("Shifeng Zhang")]),t._v("等最早于2019年12月份提交的论文中提出的方法，发表在CVPR2020会议上。")]),t._v(" "),s("p",[t._v("文中分析了"),s("code",[t._v("Anchor Based")]),t._v("和"),s("code",[t._v("Anchor Free")]),t._v("的检测方法，性能差异的主要原因在于"),s("strong",[t._v("正负训练样本的定义方式")]),t._v("不同,而和回归目标是基于**点式(point)"),s("strong",[t._v("还是")]),t._v("盒式(box)**关系不大。"),s("code",[t._v("Anchor Free")]),t._v("检测常用的有两种方法，一种是"),s("code",[t._v("keypoint_based")]),t._v(",另一种是"),s("code",[t._v("center_based")]),t._v("。"),s("code",[t._v("keypoint_based")]),t._v("的"),s("code",[t._v("Anchor Free")]),t._v("目标检测算法同标准的"),s("code",[t._v("keypoint estimation pipeline")]),t._v(",和"),s("code",[t._v("anchor based")]),t._v("的目标检测算法差异较大。但"),s("code",[t._v("center_based")]),t._v("的"),s("code",[t._v("Anchor Free")]),t._v("目标检测算法与"),s("code",[t._v("Anchor Based")]),t._v("的方法比较相近，"),s("code",[t._v("center_based")]),t._v("方法将"),s("code",[t._v("point")]),t._v("作为预设样本（如FCOS），"),s("code",[t._v("Anchor Based")]),t._v("方法是将"),s("code",[t._v("anchor")]),t._v("作为预设样本（如RetinaNet）。"),s("code",[t._v("Anchor Based")]),t._v("的"),s("code",[t._v("RetinatNet")]),t._v("与"),s("code",[t._v("Center Based")]),t._v("的"),s("code",[t._v("FCOS")]),t._v("的主要区别是:")]),t._v(" "),s("ul",[s("li",[t._v("1）"),s("code",[t._v("feature map")]),t._v("中每个位置的"),s("code",[t._v("anchor")]),t._v("数量不同，"),s("code",[t._v("RetinaNet")]),t._v("每个点生成多个"),s("code",[t._v("anchor boxes")]),t._v(","),s("code",[t._v("FCOS")]),t._v("每个点生成一个"),s("code",[t._v("anchor point")])]),t._v(" "),s("li",[t._v("2）正负样本的定义方式不同，"),s("code",[t._v("RetinaNet")]),t._v("使用"),s("code",[t._v("IoU")]),t._v("来判定正负样本,"),s("code",[t._v("FCOS")]),t._v("使用"),s("code",[t._v("patial and scale constraints")]),t._v("来判断。")]),t._v(" "),s("li",[t._v("3）回归起始状态不同。"),s("code",[t._v("RetinaNet")]),t._v("是基于"),s("code",[t._v("Anchor Box")]),t._v("的"),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:"MJX-TEX"},[s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"("}})],1),s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"x"}})],1)],1)],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:","}})],1),s("mjx-msub",{attrs:{space:"2"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"y"}})],1)],1)],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"."}})],1),s("mjx-msub",{attrs:{space:"2"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"3C9"}})],1)],1)],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:","}})],1),s("mjx-msub",{attrs:{space:"2"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"h"}})],1)],1)],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:")"}})],1)],1)],1),t._v("，"),s("code",[t._v("FCOS")]),t._v("是基于"),s("code",[t._v("Anchor Point")]),t._v("的"),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:"MJX-TEX"},[s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"("}})],1),s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"l"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"l"}})],1)],1)],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:","}})],1),s("mjx-msub",{attrs:{space:"2"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"l"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"t"}})],1)],1)],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:","}})],1),s("mjx-msub",{attrs:{space:"2"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"l"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"r"}})],1)],1)],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:","}})],1),s("mjx-msub",{attrs:{space:"2"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"l"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"o"}})],1)],1)],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:")"}})],1)],1)],1),t._v("。")],1)]),t._v(" "),s("p",[s("code",[t._v("ATSS")]),t._v("分析了"),s("code",[t._v("Anchor Based")]),t._v("和"),s("code",[t._v("Anchor Free")]),t._v("检测算法实现上的差异，得出的结论是"),s("strong",[t._v("正负样本定义方式的不同影响了两种方法检测效果的差异")]),t._v("。基于此论文提出了"),s("code",[t._v("Adaptive Training Sample Selection(ATSS)")]),t._v("算法以基于目标特征自动的计算正负样本。本文还基于实验得出了"),s("strong",[t._v("在同个位置没必要使用多个"),s("code",[t._v("anchor box")]),t._v("做检测")]),t._v("的结论。")]),t._v(" "),s("h2",{attrs:{id:"_2-目标检测相关"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-目标检测相关"}},[t._v("#")]),t._v(" 2.目标检测相关")]),t._v(" "),s("div",{staticClass:"language-mermaid extra-class"},[s("pre",{pre:!0,attrs:{class:"language-mermaid"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("graph")]),t._v(" LR\n\nA"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("(ObjectDetector)")]),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v("B"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("(AnchorBased)")]),t._v("\nA"),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v("C"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("(AnchorFree)")]),t._v("\nB"),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v("B1"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("(OneStage:SSD)")]),t._v("\nB1"),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v("B11"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("(fusing context information from different layers)")]),t._v("\nB1"),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v("B12"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("(training from scratch)")]),t._v("\nB1"),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v("B13"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("(introducing new loss function)")]),t._v("\nB1"),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v("B14"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("(anchor refinement and matching)")]),t._v("\nB1"),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v("B15"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("(architecture redesign)")]),t._v("\nB1"),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v("B16"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("(feature enrichment and alignment)")]),t._v("\nB"),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v("B2"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("(TwoStage:FasterR-CNN)")]),t._v("\nB2"),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v("B21"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("(architecture redesign and reform)")]),t._v("\nB2"),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v("B22"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("(context and attention mechanism)")]),t._v("\nB2"),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v("B23"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("(multiscale training and testing)")]),t._v("\nB2"),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v("B24"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("(training strategy and loss function)")]),t._v("\nB2"),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v("B25"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("(feature fusion and enhancement)")]),t._v("\nB2"),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v("B26"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("(better proposal and balance)")]),t._v("\nC"),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v("C1"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("(KeyPointBased:CornerNet/GridR-CNN/ExtremeNet/CenterNet/RepPoints)")]),t._v("\nC"),s("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v("C2"),s("span",{pre:!0,attrs:{class:"token text string"}},[t._v("(CenterBased:YOLO/DenseBox/FCOS/CSP/FoveaBox)")]),t._v("\n")])])]),s("h2",{attrs:{id:"_3-anchor-based与anchor-free目标检测算法的差异分析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-anchor-based与anchor-free目标检测算法的差异分析"}},[t._v("#")]),t._v(" 3."),s("code",[t._v("Anchor Based")]),t._v("与"),s("code",[t._v("Anchor Free")]),t._v("目标检测算法的差异分析")]),t._v(" "),s("p",[s("code",[t._v("Anchor Based")]),t._v("选择"),s("code",[t._v("RetinaNet")]),t._v("作为代表，"),s("code",[t._v("Anchor Free")]),t._v("选择"),s("code",[t._v("FCOS")]),t._v("作为代表，从以下三方面进行分析：")]),t._v(" "),s("ul",[s("li",[t._v("1）正负样本定义")]),t._v(" "),s("li",[t._v("2）初始回归状态，是回归"),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:"MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"x"}})],1)],1)],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:","}})],1),s("mjx-msub",{attrs:{space:"2"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"y"}})],1)],1)],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:","}})],1),s("mjx-msub",{attrs:{space:"2"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"w"}})],1)],1)],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:","}})],1),s("mjx-msub",{attrs:{space:"2"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"h"}})],1)],1)],1)],1)],1),t._v("还是"),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:"MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"l"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"l"}})],1)],1)],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:","}})],1),s("mjx-msub",{attrs:{space:"2"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"l"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"t"}})],1)],1)],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:","}})],1),s("mjx-msub",{attrs:{space:"2"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"l"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"r"}})],1)],1)],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:","}})],1),s("mjx-msub",{attrs:{space:"2"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"l"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"o"}})],1)],1)],1)],1)],1)],1),t._v(" "),s("li",[t._v("3）每个位置的"),s("code",[t._v("anchor")]),t._v("数量")])]),t._v(" "),s("h3",{attrs:{id:"_3-1-retinanet与fcos的对比"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-retinanet与fcos的对比"}},[t._v("#")]),t._v(" 3.1 "),s("code",[t._v("RetinaNet")]),t._v("与"),s("code",[t._v("FCOS")]),t._v("的对比")]),t._v(" "),s("p",[t._v("设置"),s("code",[t._v("RetinaNet")]),t._v("的"),s("code",[t._v("Anchor box")]),t._v("数量为"),s("code",[t._v("1")]),t._v("。对"),s("code",[t._v("FCOS")]),t._v("的改进：")]),t._v(" "),s("ul",[s("li",[t._v("1）将"),s("code",[t._v("centernerss")]),t._v("移到"),s("code",[t._v("regression")]),t._v("分支")]),t._v(" "),s("li",[t._v("2）使用"),s("code",[t._v("GIoU Loss")])]),t._v(" "),s("li",[t._v("3）将回归目标使用对应level的stride来归一化")])]),t._v(" "),s("p",[t._v("这些提升了"),s("code",[t._v("FCOS")]),t._v("的检测效果，"),s("code",[t._v("coco minival")]),t._v("上的"),s("code",[t._v("map")]),t._v("从"),s("code",[t._v("37.1")]),t._v("提升到了"),s("code",[t._v("37.8")]),t._v("，进一步拉开了"),s("code",[t._v("Anchor=1")]),t._v("的"),s("code",[t._v("RetinaNet")]),t._v("与"),s("code",[t._v("FCOS")]),t._v("的差距。")]),t._v(" "),s("p",[s("code",[t._v("FCOS")]),t._v("中使用的一些"),s("code",[t._v("trick")]),t._v("在"),s("code",[t._v("Anchor=1")]),t._v("的"),s("code",[t._v("RetinaNet")]),t._v("中也能使用，如检测头中使用的"),s("code",[t._v("Group Normlization")]),t._v(", "),s("code",[t._v("GIoU")]),t._v("，限制"),s("code",[t._v("ground truth box")]),t._v("中的正样本，对特征金字塔的每层加上一个中心度分支和可训练参数。将这些"),s("code",[t._v("trick")]),t._v("逐一加到"),s("code",[t._v("RetinaNet")]),t._v("上的对比结果为：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://day-pic-1311699660.cos.ap-nanjing.myqcloud.com/image/atss1.jpg",alt:""}})]),t._v(" "),s("p",[t._v("从上图可以看出，将所有的通用"),s("code",[t._v("trick")]),t._v("都应用到"),s("code",[t._v("RetinaNet")]),t._v("上后，"),s("code",[t._v("MAP")]),t._v("依然有0.8的差距。除了以上指出的通用性差异后，还有两点不同，一个是正负样本的定义方式，另一个是回归任务本身，"),s("code",[t._v("RetinaNet")]),t._v("是基于"),s("code",[t._v("Anchor Box")]),t._v("回归,"),s("code",[t._v("FCOS")]),t._v("是基于"),s("code",[t._v("Anchor Point")]),t._v("回归。")]),t._v(" "),s("h3",{attrs:{id:"_3-1-正负样本定义的区别"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-正负样本定义的区别"}},[t._v("#")]),t._v(" 3.1 正负样本定义的区别")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://day-pic-1311699660.cos.ap-nanjing.myqcloud.com/image/atss2.jpg",alt:""}})]),t._v(" "),s("p",[t._v("如上图，"),s("code",[t._v("RetinaNet")]),t._v("根据"),s("code",[t._v("ground truth box")]),t._v("与"),s("code",[t._v("anchor box")]),t._v("之间的"),s("code",[t._v("IoU")]),t._v("的值来判断是正样本还是负样本，通常设置两个超参数"),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:"MJX-TEX"},[s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"("}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"I"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"o"}})],1),s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"U"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-TeXAtom",{attrs:{size:"s"}},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"n"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"e"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"g"}})],1)],1)],1)],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:","}})],1),s("mjx-mi",{staticClass:"mjx-i",attrs:{space:"2"}},[s("mjx-c",{attrs:{c:"I"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"o"}})],1),s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"U"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-TeXAtom",{attrs:{size:"s"}},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"p"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"o"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"s"}})],1)],1)],1)],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:")"}})],1)],1)],1),t._v(",小于"),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:"MJX-TEX"},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"I"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"o"}})],1),s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"U"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-TeXAtom",{attrs:{size:"s"}},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"n"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"e"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"g"}})],1)],1)],1)],1)],1)],1),t._v("的是负样本，大于"),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:"MJX-TEX"},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"I"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"o"}})],1),s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"U"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-TeXAtom",{attrs:{size:"s"}},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"p"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"o"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"s"}})],1)],1)],1)],1)],1)],1),t._v("的是正样本，在两者之间的"),s("code",[t._v("Anchor Box")]),t._v("被忽略，不参与训练,"),s("code",[t._v("RPN")]),t._v("生产的"),s("code",[t._v("Proposal Box")]),s("a",{attrs:{href:"https://arxiv.org/pdf/1612.03144",target:"_blank",rel:"noopener noreferrer"}},[t._v("基于"),s("code",[t._v("FPN")]),t._v("论文中提出的方程式2赋值给某个"),s("code",[t._v("feature")]),t._v("层"),s("OutboundLink")],1),t._v("。"),s("code",[t._v("FCOS")]),t._v("则先根据"),s("code",[t._v("Anchor Point")]),t._v("的空间位置是否落在"),s("code",[t._v("ground truth box")]),t._v("中找出可能为正的"),s("code",[t._v("Anchor Point")]),t._v(",再根据"),s("code",[t._v("Anchor Point")]),t._v("对应"),s("code",[t._v("feature map")]),t._v("上的回归范围"),s("code",[t._v("regression scale")]),t._v("来近一步确认是否为正样本，参考见博客"),s("a",{attrs:{href:"https://foobarweb.net/2022/09/22/7FCOSNet/",target:"_blank",rel:"noopener noreferrer"}},[t._v("FCOSNet"),s("OutboundLink")],1),t._v("。基于"),s("code",[t._v("Spatial and Scale")]),t._v("的正样本判定方式决定了检测器的优秀性能，如下表，使用"),s("code",[t._v("Spatial and Scale")]),t._v("后，"),s("code",[t._v("Anchor=1的RetinaNet")]),t._v("的"),s("code",[t._v("MAP")]),t._v("也提升到了"),s("code",[t._v("37.8")]),t._v(",换用"),s("code",[t._v("IoU")]),t._v("的"),s("code",[t._v("FCOS")]),t._v("的"),s("code",[t._v("MAP")]),t._v("降到了"),s("code",[t._v("36.9")]),t._v("：")],1),t._v(" "),s("p",[s("img",{attrs:{src:"https://day-pic-1311699660.cos.ap-nanjing.myqcloud.com/image/atss3.jpg",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"_3-2-回归起始位置的差异"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-回归起始位置的差异"}},[t._v("#")]),t._v(" 3.2 回归起始位置的差异")]),t._v(" "),s("p",[t._v("如下图，"),s("code",[t._v("Anchor=1的RetinaNet")]),t._v("回归的是"),s("code",[t._v("AnchorBox")]),t._v("相对于"),s("code",[t._v("ground truth box")]),t._v("的平移缩放"),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:"MJX-TEX"},[s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"("}})],1),s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"x"}})],1)],1)],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:","}})],1),s("mjx-msub",{attrs:{space:"2"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"y"}})],1)],1)],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:","}})],1),s("mjx-msub",{attrs:{space:"2"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"w"}})],1)],1)],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:","}})],1),s("mjx-msub",{attrs:{space:"2"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"h"}})],1)],1)],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:")"}})],1)],1)],1),t._v("即基于"),s("code",[t._v("box")]),t._v("的回归,而"),s("code",[t._v("FCOS")]),t._v("回归的是中心点距离"),s("code",[t._v("ground truth box")]),t._v("四边的距离"),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:"MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"l"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"l"}})],1)],1)],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:","}})],1),s("mjx-msub",{attrs:{space:"2"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"l"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"t"}})],1)],1)],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:","}})],1),s("mjx-msub",{attrs:{space:"2"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"l"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"r"}})],1)],1)],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:","}})],1),s("mjx-msub",{attrs:{space:"2"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"l"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"b"}})],1)],1)],1)],1)],1),t._v("，即基于点的回归。从上图中按行方向比较可以发现，使用"),s("code",[t._v("box")]),t._v("或"),s("code",[t._v("point")]),t._v("的回归方式对最终的结果影响不大，"),s("code",[t._v("37->36.9")]),t._v(",‵37.8->37.8`。")],1),t._v(" "),s("p",[s("img",{attrs:{src:"https://day-pic-1311699660.cos.ap-nanjing.myqcloud.com/image/atss4.jpg",alt:""}})]),t._v(" "),s("p",[t._v("综合3.1和3.2的分析，可以得出结论："),s("strong",[t._v("是正负样本的定义方式不同影响了"),s("code",[t._v("Anchor Based")]),t._v("和"),s("code",[t._v("Anchor Free")]),t._v("算法的性能")]),t._v("。")]),t._v(" "),s("h2",{attrs:{id:"_4-自适应训练样本选择"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-自适应训练样本选择"}},[t._v("#")]),t._v(" 4.自适应训练样本选择")]),t._v(" "),s("p",[t._v("从前面作者得出的结论，"),s("strong",[t._v("How to define positive and negative samples")]),t._v("极大影响了检测器的性能，基于此作者提出了新的"),s("code",[t._v("samples")]),t._v("分类算法，"),s("strong",[t._v("自适应训练样本选择(Adaptive Training Sample Selection, ATSS)")]),t._v("。")]),t._v(" "),s("p",[s("code",[t._v("Anchor Based")]),t._v("基于"),s("code",[t._v("IoU")]),t._v("和"),s("code",[t._v("Anchor Free")]),t._v("基于"),s("code",[t._v("Scale Range")]),t._v("的正样本定义方法都依赖预先定义好的"),s("strong",[t._v("超参数")]),t._v("，"),s("code",[t._v("ATSS")]),t._v("提出了一种自适应取阈值的方法，减少了"),s("code",[t._v("sample definition")]),t._v("所需的超参数。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://day-pic-1311699660.cos.ap-nanjing.myqcloud.com/image/atss5.jpg",alt:""}})]),t._v(" "),s("p",[t._v("以一张输入图像为例说明上图"),s("code",[t._v("ATSS")]),t._v("算法的工作流程：")]),t._v(" "),s("ul",[s("li",[t._v("1）对于1个"),s("code",[t._v("ground truth box")]),t._v(",分别在每个金字塔特征层上取中心"),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:"MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"L"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mn",{staticClass:"mjx-n",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"2"}})],1)],1)],1)],1)],1),t._v("距离最近的"),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:"MJX-TEX"},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"k"}})],1)],1)],1),t._v("个"),s("code",[t._v("anchor boxes")]),t._v("作为候选"),s("code",[t._v("positive sample")]),t._v(",对于有"),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:"MJX-TEX"},[s("mjx-TeXAtom",[s("mjx-mi",{staticClass:"mjx-cal"},[s("mjx-c",{attrs:{c:"L"}})],1)],1)],1)],1),t._v("个金字塔特征层的网络，共得到"),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:"MJX-TEX"},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"k"}})],1),s("mjx-TeXAtom",[s("mjx-mi",{staticClass:"mjx-cal"},[s("mjx-c",{attrs:{c:"L"}})],1)],1)],1)],1),t._v("个"),s("code",[t._v("candidate positive anchor boxes")])],1),t._v(" "),s("li",[t._v("2）计算"),s("code",[t._v("candidates")]),t._v("与"),s("code",[t._v("ground truth boxes")]),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:"MJX-TEX"},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"g"}})],1),s("mjx-mo",{staticClass:"mjx-n",attrs:{space:"4"}},[s("mjx-c",{attrs:{c:"2208"}})],1),s("mjx-msub",[s("mjx-TeXAtom",[s("mjx-mi",{staticClass:"mjx-cal",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"D"}})],1)],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-TeXAtom",{attrs:{size:"s"}},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"g"}})],1)],1)],1)],1)],1)],1),t._v("之间的"),s("code",[t._v("IoU")])],1),t._v(" "),s("li",[t._v("3）计算2）中"),s("code",[t._v("IoU")]),t._v("的均值"),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:"MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"m"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-TeXAtom",{attrs:{size:"s"}},[s("mjx-TeXAtom",[s("mjx-mi",{staticClass:"mjx-cal"},[s("mjx-c",{attrs:{c:"g"}})],1)],1)],1)],1)],1)],1)],1),t._v("和标准差"),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:"MJX-TEX"},[s("mjx-msub",[s("mjx-TeXAtom",[s("mjx-mi",{staticClass:"mjx-cal",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"v"}})],1)],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-TeXAtom",{attrs:{size:"s"}},[s("mjx-TeXAtom",[s("mjx-mi",{staticClass:"mjx-cal"},[s("mjx-c",{attrs:{c:"g"}})],1)],1)],1)],1)],1)],1)],1)],1),t._v(" "),s("li",[t._v("4）取"),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:"MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"g"}})],1)],1)],1),s("mjx-mo",{staticClass:"mjx-n",attrs:{space:"4"}},[s("mjx-c",{attrs:{c:"="}})],1),s("mjx-msub",{attrs:{space:"4"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"m"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-TeXAtom",{attrs:{size:"s"}},[s("mjx-TeXAtom",[s("mjx-mi",{staticClass:"mjx-cal"},[s("mjx-c",{attrs:{c:"g"}})],1)],1)],1)],1)],1),s("mjx-mo",{staticClass:"mjx-n",attrs:{space:"3"}},[s("mjx-c",{attrs:{c:"+"}})],1),s("mjx-msub",[s("mjx-TeXAtom",[s("mjx-mi",{staticClass:"mjx-cal",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"v"}})],1)],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-TeXAtom",{attrs:{size:"s"}},[s("mjx-TeXAtom",[s("mjx-mi",{staticClass:"mjx-cal"},[s("mjx-c",{attrs:{c:"g"}})],1)],1)],1)],1)],1)],1)],1),t._v("作为阈值，大于"),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:"MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"g"}})],1)],1)],1)],1)],1),t._v("的是"),s("code",[t._v("positive")]),t._v(",其余的"),s("code",[t._v("Anchor Boxes")]),t._v("都是"),s("code",[t._v("negative")])],1)]),t._v(" "),s("p",[t._v("作者指出，当一个"),s("code",[t._v("anchor box")]),t._v("同时落入两个"),s("code",[t._v("ground truth box")]),t._v("中时，会将其分配给"),s("code",[t._v("IoU")]),t._v("比较大的"),s("code",[t._v("ground truth box")]),t._v("。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://day-pic-1311699660.cos.ap-nanjing.myqcloud.com/image/atss6.jpg",alt:""}})]),t._v(" "),s("p",[t._v("从上图可以看出"),s("code",[t._v("ATSS")]),t._v("的作用，对于某个"),s("code",[t._v("ground truth box")]),t._v(",图a中标准差较大，意味着有某个金字塔特征层比较适合预测该"),s("code",[t._v("box")]),t._v("，因此阈值"),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:"MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"g"}})],1)],1)],1)],1)],1),t._v("也比较大。图b中标准差不大，意味者可能有多个特征层适合预测当前"),s("code",[t._v("box")]),t._v(",因此选取的阈值"),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:"MJX-TEX"},[s("mjx-msub",[s("mjx-mi",{staticClass:"mjx-i",attrs:{noIC:"true"}},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-script",{staticStyle:{"vertical-align":"-0.15em"}},[s("mjx-mi",{staticClass:"mjx-i",attrs:{size:"s"}},[s("mjx-c",{attrs:{c:"g"}})],1)],1)],1)],1)],1),t._v("也较小。")],1),t._v(" "),s("p",[t._v("作者还指出使用"),s("code",[t._v("ATSS")]),t._v(","),s("strong",[t._v("可以使得对于不同大小的目标对象得到相同比例的正负训练样本")]),t._v("。对于标准正态分布有"),s("code",[t._v("16%")]),t._v("的样本落在"),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:"MJX-TEX"},[s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"["}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"v"}})],1),s("mjx-mo",{staticClass:"mjx-n",attrs:{space:"3"}},[s("mjx-c",{attrs:{c:"+"}})],1),s("mjx-mi",{staticClass:"mjx-i",attrs:{space:"3"}},[s("mjx-c",{attrs:{c:"3C3"}})],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:","}})],1),s("mjx-mn",{staticClass:"mjx-n",attrs:{space:"2"}},[s("mjx-c",{attrs:{c:"1"}})],1),s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"]"}})],1)],1)],1),t._v("之间，虽然"),s("code",[t._v("IoU of candidates")]),t._v("不是正态分布，正样本的比例依然保持在了"),s("code",[t._v("20% of")]),t._v(" "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:"MJX-TEX"},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"k"}})],1),s("mjx-TeXAtom",[s("mjx-mi",{staticClass:"mjx-cal"},[s("mjx-c",{attrs:{c:"L"}})],1)],1)],1)],1),t._v(" 左右,和目标"),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"CHTML"}},[s("mjx-math",{staticClass:"MJX-TEX"},[s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"s"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"c"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"a"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"l"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"e"}})],1),s("mjx-TeXAtom",[s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"/"}})],1)],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"a"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"s"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"p"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"e"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"c"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"r"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"a"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"i"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"o"}})],1),s("mjx-TeXAtom",[s("mjx-mo",{staticClass:"mjx-n"},[s("mjx-c",{attrs:{c:"/"}})],1)],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"l"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"o"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"c"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"a"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"t"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"i"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"o"}})],1),s("mjx-mi",{staticClass:"mjx-i"},[s("mjx-c",{attrs:{c:"n"}})],1)],1)],1),t._v("无关。而"),s("code",[t._v("RetinaNet")]),t._v("和"),s("code",[t._v("FCOS")]),t._v("都会倾向于对大目标生成更多的正样本。")],1),t._v(" "),s("p",[s("code",[t._v("ATSS")]),t._v("使用的超参数很少，只有"),s("code",[t._v("k")]),t._v("一个，且算法效果对"),s("code",[t._v("k")]),t._v("不敏感。实验证明"),s("code",[t._v("k")]),t._v("取"),s("code",[t._v("[3, 5, 7, 9, 11, 13, 15, 17, 19]")]),t._v("时"),s("code",[t._v("map")]),t._v("变化不大：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://day-pic-1311699660.cos.ap-nanjing.myqcloud.com/image/atss7.jpg",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"_5-代码实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-代码实现"}},[t._v("#")]),t._v(" 5.代码实现")]),t._v(" "),s("p",[s("code",[t._v("mmdetection")]),t._v("中"),s("code",[t._v("ATSS")]),t._v("算法的实现在"),s("code",[t._v("ATSSAssigner")]),t._v("类中，"),s("code",[t._v("assign")]),t._v("的部分代码如下：")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Selecting candidates based on the center distance")]),t._v("\n     candidate_idxs "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n     start_idx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" level"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" bboxes_per_level "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("enumerate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("num_level_bboxes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# on each pyramid level, for each gt,")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# select k bbox whose center are closest to the gt center")]),t._v("\n          end_idx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" start_idx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" bboxes_per_level\n          distances_per_level "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" distances"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("start_idx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("end_idx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n          selectable_k "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("min")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("topk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" bboxes_per_level"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n          _"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" topk_idxs_per_level "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" distances_per_level"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("topk"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n               selectable_k"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dim"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" largest"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n          candidate_idxs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("append"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("topk_idxs_per_level "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" start_idx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n          start_idx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" end_idx\n     candidate_idxs "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" torch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("candidate_idxs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dim"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# get corresponding iou for the these candidates, and compute the")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mean and std, set mean + std as the iou threshold")]),t._v("\n     candidate_overlaps "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" overlaps"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("candidate_idxs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" torch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("arange"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("num_gt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n     overlaps_mean_per_gt "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" candidate_overlaps"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mean"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n     overlaps_std_per_gt "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" candidate_overlaps"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("std"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n     overlaps_thr_per_gt "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" overlaps_mean_per_gt "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" overlaps_std_per_gt\n\n     is_pos "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" candidate_overlaps "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),t._v(" overlaps_thr_per_gt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# limit the positive sample's center in gt")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" gt_idx "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("range")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("num_gt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          candidate_idxs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" gt_idx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" gt_idx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" num_bboxes\n     ep_bboxes_cx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" bboxes_cx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("view"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("expand"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n          num_gt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" num_bboxes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("contiguous"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("view"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n     ep_bboxes_cy "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" bboxes_cy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("view"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("expand"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n          num_gt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" num_bboxes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("contiguous"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("view"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n     candidate_idxs "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" candidate_idxs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("view"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# calculate the left, top, right, bottom distance between positive")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# bbox center and gt side")]),t._v("\n     l_ "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ep_bboxes_cx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("candidate_idxs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("view"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" num_gt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" gt_bboxes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n     t_ "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ep_bboxes_cy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("candidate_idxs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("view"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" num_gt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" gt_bboxes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n     r_ "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" gt_bboxes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" ep_bboxes_cx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("candidate_idxs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("view"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" num_gt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n     b_ "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" gt_bboxes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" ep_bboxes_cy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("candidate_idxs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("view"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" num_gt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n     is_in_gts "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" torch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stack"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("l_"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" t_"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" r_"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b_"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dim"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("min")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dim"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.01")]),t._v("\n\n     is_pos "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" is_pos "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" is_in_gts\n\n")])])]),s("InArticleAdsense",{attrs:{"data-ad-client":"ca-pub-8685746128991385","data-ad-slot":"2974191661"}}),t._v(" "),s("h3",{attrs:{id:"参考资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),s("blockquote",[s("ul",[s("li",[s("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/358125611",target:"_blank",rel:"noopener noreferrer"}},[t._v("1.https://zhuanlan.zhihu.com/p/358125611"),s("OutboundLink")],1)])])])],1)}),[],!1,null,null,null);s.default=r.exports}}]);