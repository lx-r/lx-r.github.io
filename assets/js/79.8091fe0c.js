(window.webpackJsonp=window.webpackJsonp||[]).push([[79],{400:function(t,a,s){"use strict";s.r(a);var e=s(17),n=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"图像数据的序列化与反序列化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#图像数据的序列化与反序列化"}},[t._v("#")]),t._v(" 图像数据的序列化与反序列化")]),t._v(" "),a("h2",{attrs:{id:"_1-python中输入输出流"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-python中输入输出流"}},[t._v("#")]),t._v(" 1.Python中输入输出流")]),t._v(" "),a("p",[t._v("Python的"),a("code",[t._v("io")]),t._v("模块提供了"),a("code",[t._v("Python")]),t._v("中处理各种类型输入输出的主要功能，"),a("code",[t._v("Python")]),t._v("中处理的主要有"),a("code",[t._v("3")]),t._v("种类型的"),a("code",[t._v("io")]),t._v(",分别是"),a("br"),t._v(" "),a("code",[t._v("text I/O")]),t._v(","),a("code",[t._v("binary I/O")]),t._v("和"),a("code",[t._v("raw I/O")]),t._v("。这三种类型的具体对象都是"),a("code",[t._v("文件对象")]),t._v(",有时也被称为"),a("code",[t._v("流")]),t._v("， "),a("code",[t._v("类文件对象")]),t._v("。各种流对象处理不同的文件类型。例如，往"),a("code",[t._v("binary")]),t._v("流对像中写入"),a("code",[t._v("str")]),t._v("类型的对象会报类型错误"),a("code",[t._v("TypeError")]),t._v(",同样往"),a("code",[t._v("text")]),t._v("流对象中写入"),a("code",[t._v("binary")]),t._v("类型的内容时也会报错。")]),t._v(" "),a("p",[a("code",[t._v("text")]),t._v("流对象主要处理"),a("code",[t._v("str")]),t._v("类型文件的读取和写入，当文件是以字节为单位存储时，通过"),a("code",[t._v("text")]),t._v("流对象可以使得文件的编解码和如换行符等的跨平台支持变的无感。最简单的创建"),a("code",[t._v("text")]),t._v("流对象的方式是通过"),a("code",[t._v("open")]),t._v("函数，如")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" io\nf "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text.txt'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'r'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" encoding"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'utf8'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在内存中的字节流可以通过io.StringIO来创建")]),t._v("\nf "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" io"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("StringIO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"some text"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[a("code",[t._v("binary I/O")]),t._v("用来处理类字节对象，并返回一个字节对象"),a("code",[t._v("bytes object")]),t._v(","),a("code",[t._v("Python")]),t._v("中的"),a("code",[t._v("bytes")]),t._v("类和"),a("code",[t._v("str")]),t._v("差不多，只是在定义时引号前面加"),a("code",[t._v("b")]),t._v("，如"),a("code",[t._v("bytes_data = b'data'")]),t._v(","),a("code",[t._v("bytes")]),t._v("对象只支持"),a("code",[t._v("ASCII")]),t._v("码字符，任何二进制码超过"),a("code",[t._v("127")]),t._v("的字符在"),a("code",[t._v("bytes")]),t._v("对象中必须以"),a("code",[t._v("转移序列")]),t._v("来表示。类字节对象"),a("code",[t._v("bytes-like object")]),t._v("是支持"),a("code",[t._v("缓存协议")]),a("a",{attrs:{href:"https://docs.python.org/3/glossary.html#term-bytes-like-object",target:"_blank",rel:"noopener noreferrer"}},[t._v("Buffer Protocol"),a("OutboundLink")],1),t._v("且能输出一个"),a("code",[t._v("C")]),t._v("语言连续缓存的对象，"),a("code",[t._v("binary I/O")]),t._v("不会自动对文件进行编解码和换行符转换。"),a("code",[t._v("binary I/O")]),t._v("用来处理非文本数据和或者想要手动控制文本数据的处理时。创建"),a("code",[t._v("binary I/O")]),t._v("对象的最简单方式是：")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("f "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"myfile.jpg"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rb"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 从内存中读取")]),t._v("\nf "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" io"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BytesIO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('b"some initial binary data: \\x00\\x01"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h2",{attrs:{id:"_2-png文件格式简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-png文件格式简介"}},[t._v("#")]),t._v(" 2."),a("code",[t._v("png")]),t._v("文件格式简介")]),t._v(" "),a("p",[a("code",[t._v("png")]),t._v("图片格式是"),a("strong",[t._v("可携式网络图形")]),t._v("（"),a("code",[t._v("P ortable N etwork G raphics，PNG")]),t._v("）是一种支援无损压缩的点阵图图形格式，支援索引、灰度、RGB三种颜色方案以及Alpha通道等特性。PNG的开发目标是改善并取代GIF作为适合网络传输的格式而不需专利许可,PNG于1997年3月作为知识性RFC 2083发布，于2004年作为ISO/IEC标准发布"),a("a",{attrs:{href:"https://zh.wikipedia.org/zh-hk/PNG#%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84",target:"_blank",rel:"noopener noreferrer"}},[t._v("2"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("p",[a("code",[t._v("png")]),t._v("文件中，按字节读取后可以看到，开头的8个字节码总是十六进制数"),a("code",[t._v("89 50 4E 47 0D 0A 1A 0A")]),t._v(",这正是"),a("code",[t._v("png")]),t._v("格式文件的署名，是用来标识"),a("code",[t._v("png")]),t._v("格式的，所以只是修改了文件的后缀名，软件还是能够知道图片是"),a("code",[t._v("png")]),t._v("格式的。下面是通过"),a("code",[t._v("python")]),t._v("的"),a("code",[t._v("builtin.open")]),t._v("函数按"),a("code",[t._v("bytes")]),t._v("对象读取"),a("code",[t._v("png")]),t._v("文件后得到的输出部分，")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("p "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sample.png"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rb'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" f"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    img_data "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" f"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("img_data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# b'\\x89PNG\\r\\n\\x1a\\n\\x00\\x00\\x00\\rIHDR\\x00\\x0...'")]),t._v("\n")])])]),a("p",[t._v("可以看到前8个字节分别是"),a("code",[t._v("\\x89PNG\\r\\n\\x1a\\n")]),t._v(",十六进制数"),a("code",[t._v("0x50")]),t._v(","),a("code",[t._v("0x4e")]),t._v(","),a("code",[t._v("0x47")]),t._v(","),a("code",[t._v("0x0d")]),t._v(","),a("code",[t._v("oxoa")]),t._v("分别对应的"),a("code",[t._v("ASCII")]),t._v("码正是"),a("code",[t._v("P")]),t._v(","),a("code",[t._v("N")]),t._v(","),a("code",[t._v("G")]),t._v(","),a("code",[t._v("CR")]),t._v(","),a("code",[t._v("LF")]),a("a",{attrs:{href:"https://tool.oschina.net/commons?type=4",target:"_blank",rel:"noopener noreferrer"}},[t._v("3"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("p",[a("code",[t._v("png")]),t._v("中定义了两种数据块，一种是PNG档案必须包含、读写软件也都必须要支援的关键块（"),a("code",[t._v("critical chunk")]),t._v("）;另一种叫做辅助块（"),a("code",[t._v("ancillary chunks")]),t._v("），PNG允许软件忽略它不认识的附加块。")]),t._v(" "),a("p",[a("strong",[t._v("关键数据块")]),t._v("中有4个标准数据块：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("档案头数据块IHDR（header chunk）：包含有图像基本信息，如宽高等，作为第一个数据块出现并只出现一次，其长度为固定的13个字节："),a("br"),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[a("div",[a("div",{staticClass:"table-header"},[a("p",[t._v("描述")])])])]),a("th",{staticStyle:{"text-align":"left"}},[a("div",[a("div",{staticClass:"table-header"},[a("p",[t._v("长度")])])])])])]),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("div",[a("div",{staticClass:"table-cell"},[a("p",[t._v("图片宽度")])])])]),a("td",{staticStyle:{"text-align":"left"}},[a("div",[a("div",{staticClass:"table-cell"},[a("p",[t._v("4字节")])])])])]),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("div",[a("div",{staticClass:"table-cell"},[a("p",[t._v("图片高度")])])])]),a("td",{staticStyle:{"text-align":"left"}},[a("div",[a("div",{staticClass:"table-cell"},[a("p",[t._v("4字节")])])])])]),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("div",[a("div",{staticClass:"table-cell"},[a("p",[t._v("图像深度")])])])]),a("td",{staticStyle:{"text-align":"left"}},[a("div",[a("div",{staticClass:"table-cell"},[a("p",[t._v("1字节")])])])])]),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("div",[a("div",{staticClass:"table-cell"},[a("p",[t._v("颜色类型")])])])]),a("td",{staticStyle:{"text-align":"left"}},[a("div",[a("div",{staticClass:"table-cell"},[a("p",[t._v("1字节")])])])])]),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("div",[a("div",{staticClass:"table-cell"},[a("p",[t._v("压缩方法")])])])]),a("td",{staticStyle:{"text-align":"left"}},[a("div",[a("div",{staticClass:"table-cell"},[a("p",[t._v("1字节")])])])])]),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("div",[a("div",{staticClass:"table-cell"},[a("p",[t._v("过滤方式")])])])]),a("td",{staticStyle:{"text-align":"left"}},[a("div",[a("div",{staticClass:"table-cell"},[a("p",[t._v("1字节")])])])])]),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("div",[a("div",{staticClass:"table-cell"},[a("p",[t._v("扫描方式")])])])]),a("td",{staticStyle:{"text-align":"left"}},[a("div",[a("div",{staticClass:"table-cell"},[a("p",[t._v("1字节")])])])])])])])]),t._v(" "),a("p",[t._v("如上面打开的图像的"),a("code",[t._v("IHDR\\x00\\x00\\x00\\xb6\\x00\\x00\\x00\\x86")]),t._v("可知图像宽高为"),a("code",[t._v("\\x00\\x00\\x00\\xb6")]),t._v("即182和"),a("code",[t._v("\\x00\\x00\\x00\\x86")]),t._v("即134。")])]),t._v(" "),a("li",[a("p",[t._v("调色盘数据块PLTE（palette chunk）：必须放在图像数据块之前。")])]),t._v(" "),a("li",[a("p",[t._v("图像数据块IDAT（image data chunk）：储存实际图像数据。PNG数据允许包含多个连续的图像数据块。")])]),t._v(" "),a("li",[a("p",[t._v("图像结束数据IEND（image trailer chunk）：放在档案尾部，表示PNG数据流结束。")])])]),t._v(" "),a("p",[a("strong",[t._v("辅助数据块")]),t._v("：常见的有：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("数据块识别符号")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("数据块含意")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("数据块位置限制")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("cHRM")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("基色和白色点数据块")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("放在PLTE和IDAT之前")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("gAMA")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("图像γ数据块")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("放在PLTE和IDAT之前")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("pHYs")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("物理像素尺寸数据块")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("放在IDAT之前")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("tIME")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("图像最后修改时间数据块")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("无限制")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("tEXt")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("档案基本讯息数据块")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("无限制")])])])]),t._v(" "),a("h2",{attrs:{id:"_3-pil库解析图像数据4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-pil库解析图像数据4"}},[t._v("#")]),t._v(" 3.PIL库解析图像数据"),a("a",{attrs:{href:"https://pillow.readthedocs.io/en/stable/reference/Image.html#PIL.Image.frombuffer",target:"_blank",rel:"noopener noreferrer"}},[t._v("4"),a("OutboundLink")],1)]),t._v(" "),a("ul",[a("li",[a("code",[t._v("PIL.Image.open(fp, mode='r', formats=None)")])])]),t._v(" "),a("p",[a("code",[t._v("fp")]),t._v("参数支持图像文件路径，如"),a("code",[t._v("string/Path/文件对象")]),t._v("。对于普通的"),a("code",[t._v("png")]),t._v("文件，可以通过"),a("code",[t._v("PIL.Image.open(filename)")]),t._v("函数来直接读取，")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" PIL "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Image\np "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sample.png"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1.read from data path")]),t._v("\nimg "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取图像的exif信息")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("img"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("getexif"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2.read from file object")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" f"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n     img_b "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" io"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BytesIO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("f"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n     img "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("img_b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("ul",[a("li",[a("code",[t._v("PIL.Image.frombuffer(mode, size, data, decoder_name='raw', *args)")])])]),t._v(" "),a("p",[t._v("基于字节缓存来创建一幅图像，值得注意的是"),a("code",[t._v("frombuffer")]),t._v("只解析像素数据，所以只能从像素数据（同"),a("code",[t._v("png")]),t._v("中"),a("code",[t._v("IDAT")]),t._v("部分）的字节缓存中恢复图像，不能直接使用"),a("code",[t._v("png")]),t._v("中读取的数据，因其包含有辅助数据等。可以解析"),a("code",[t._v("Image.tobytes")]),t._v("或"),a("code",[t._v("numpy.tobytes(order='c'))")]),t._v("生成的结果来构造图像。 同样还有"),a("code",[t._v("Image.frombytes")]),t._v("函数。")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" numpy "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" np\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" f"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n     img_b "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" io"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BytesIO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("f"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n     img "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("img_b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1.from Image.tobytes")]),t._v("\nimg_bytes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" img"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tobytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nimg "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("frombuffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'RGB'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("182")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("134")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" img_bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2.from numpy.tobytes")]),t._v("\nfb "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" io"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BytesIO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nfb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("write"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("img_bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nimg_bytes_buffer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("getbuffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nimg_bytes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" np"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("frombuffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("img_bytes_buffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("dtype"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("np"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("uint8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("reshape"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("182")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("134")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nimg_bytes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" img_bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tobytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("order"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'C'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("img "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("frombuffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'RGB'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("182")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("134")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" img_bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h2",{attrs:{id:"_4-opencv解析图像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-opencv解析图像"}},[t._v("#")]),t._v(" 4.opencv解析图像")]),t._v(" "),a("p",[t._v("同样，使用"),a("code",[t._v("OpenCV")]),t._v("读取图像，可通过"),a("code",[t._v("imread")]),t._v("，也可以使用"),a("code",[t._v("decode")]),t._v("方法从内存数据中解析，譬如"),a("code",[t._v("png")]),t._v("格式的文件，可以先通过"),a("code",[t._v("builtin.open")]),t._v("读取成字节流，再使用"),a("code",[t._v("np.frombuffer(bytes， dtype=uint8)")]),t._v("构造图片的缓存数据后使用"),a("code",[t._v("imdecode")]),t._v("方法得到图像数据。")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" PIL "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Image\np "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sample.png"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rb'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" f"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n     img_bytes_data "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" f"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n     img_buffer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" np"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("frombuffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("img_bytes_data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dtype"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("np"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("uint8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n     img "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cv2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("imdecode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("img_buffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cv2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("IMREAD_COLOR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n     cv2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cvtColor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("img"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cv2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("COLOR_RGB2BGR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" img"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n     plt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("imshow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("img"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("当然这里只是一个示例，正常"),a("code",[t._v("cv2.imdecode")]),t._v("肯定不是通过这种方式使用，通常与"),a("code",[t._v("cv2.imencode")]),t._v("结合使用，用于图像数据的传递。")]),t._v(" "),a("h2",{attrs:{id:"_5-labelme标注文件中的img-data数据解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-labelme标注文件中的img-data数据解析"}},[t._v("#")]),t._v(" 5."),a("code",[t._v("labelme")]),t._v("标注文件中的"),a("code",[t._v("img_data")]),t._v("数据解析")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" base64\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" cv2\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" numpy "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" np\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" PIL "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Image\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" matplotlib "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" pyplot "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" plt\n\njson_path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sample.json"')]),t._v("\ndata "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" json"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("load"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("json_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ndata "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"imageData"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nbytes_data "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" base64"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("b64decode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1.use Image to reconstruct image")]),t._v("\nbd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" io"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BytesIO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bytes_data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nimg "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2.use cv2.imdecode to reconstruct image")]),t._v("\nimg_data "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" np"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("frombuffer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bytes_data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dtype"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("np"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("uint8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nimg "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cv2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("imdecode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("img_data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cv2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("IMREAD_COLOR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ncv2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cvtColor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("img"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cv2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("COLOR_RGB2BGR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" img"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nplt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("imshow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("img"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"https://day-pic-1311699660.cos.ap-nanjing.myqcloud.com/image/b2ires08.jpg",alt:""}})]),t._v(" "),a("p",[t._v("图像数据保存到"),a("code",[t._v("json")]),t._v("文件中时，为了可视化的方便，通常对图像数据使用"),a("code",[t._v("base64")]),t._v("进行了编码，因此解析"),a("code",[t._v("json")]),t._v("中的"),a("code",[t._v("img_data")]),t._v("数据时要先使用"),a("code",[t._v("base64")]),t._v("解码得到图像数据的字节码，再使用"),a("code",[t._v("numpy.frombuffer（bytes, dtype=uint8）")]),t._v("方法创建"),a("code",[t._v("cv2.imdecode")]),t._v("能够解析的内存块数据，"),a("code",[t._v("cv2.imdecode")]),t._v("解析的是完整的图像数据而非只有像素数据，包括图像的宽高创建日期等信息，所以不需要额外的信息即可恢复图像。"),a("code",[t._v("base64")]),t._v("模块支持"),a("code",[t._v("Base16/Base32/Base64/Base85")]),t._v("编解码方法"),a("a",{attrs:{href:"https://docs.python.org/3/library/base64.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("5"),a("OutboundLink")],1),t._v("，其作用主要是将二进制数据编码成可打印的"),a("code",[t._v("ASCII")]),t._v("码，以"),a("code",[t._v("Base16")]),t._v("算法为例，"),a("code",[t._v("Base16")]),t._v("编码会将字节切为4个一组，所以此编码后会用到2个字符，数据会变为原来的2倍。类推，"),a("code",[t._v("Base32")]),t._v("编码会将字节切为 5 个一组，每 5 个字节可以重组为8个字符。")]),t._v(" "),a("InArticleAdsense",{attrs:{"data-ad-client":"ca-pub-8685746128991385","data-ad-slot":"2974191661"}}),t._v(" "),a("h3",{attrs:{id:"参考资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),a("blockquote",[a("ul",[a("li",[a("a",{attrs:{href:"https://docs.python.org/3/library/io.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("1.https://docs.python.org/3/library/io.html"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://zh.wikipedia.org/zh-hk/PNG#%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84",target:"_blank",rel:"noopener noreferrer"}},[t._v("2.https://zh.wikipedia.org/zh-hk/PNG#%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://tool.oschina.net/commons?type=4",target:"_blank",rel:"noopener noreferrer"}},[t._v("3.https://tool.oschina.net/commons?type=4"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://pillow.readthedocs.io/en/stable/reference/Image.html#PIL.Image.frombuffer",target:"_blank",rel:"noopener noreferrer"}},[t._v("4.https://pillow.readthedocs.io/en/stable/reference/Image.html#PIL.Image.frombuffer"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://docs.python.org/3/library/base64.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("5.https://docs.python.org/3/library/base64.html"),a("OutboundLink")],1)])])])],1)}),[],!1,null,null,null);a.default=n.exports}}]);