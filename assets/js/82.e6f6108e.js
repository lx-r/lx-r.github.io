(window.webpackJsonp=window.webpackJsonp||[]).push([[82],{399:function(t,s,a){"use strict";a.r(s);var n=a(17),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"mask-r-cnn-in-detectron2-for-key-point-detect"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mask-r-cnn-in-detectron2-for-key-point-detect"}},[t._v("#")]),t._v(" Mask R-CNN in Detectron2 for Key Point Detect")]),t._v(" "),s("h2",{attrs:{id:"_1-coco数据集中定义的人体关键点检测任务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-coco数据集中定义的人体关键点检测任务"}},[t._v("#")]),t._v(" 1.COCO数据集中定义的人体关键点检测任务")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://day-pic-1311699660.cos.ap-nanjing.myqcloud.com/image/kp1.jpg",alt:""}})]),t._v(" "),s("p",[t._v("人体关键点检测常用于人体姿态估计，不仅需要找到人的"),s("code",[t._v("bounding box")]),t._v("，还需要找出其中关键点的位置。"),s("code",[t._v("coco")]),t._v("中"),s("code",[t._v("human")]),t._v("这个类别每个对象定义了17种关键点，依次是"),s("code",[t._v("['nose', 'left_eye', 'right_eye', 'left_ear', 'right_ear', 'left_shoulder', 'right_shoulder', 'left_elbow', 'right_elbow', 'left_wrist', 'right_wrist', 'left_hip', 'right_hip', 'left_knee', 'right_knee', 'left_ankle', 'right_ankle']")]),t._v(",此外还有"),s("code",[t._v("skeleton")]),t._v("骨架字段，表示各个种类关键点之间的连接信息，如"),s("code",[t._v("[6, 7]")]),t._v("表示"),s("code",[t._v("left_shoulder")]),t._v("与"),s("code",[t._v("left_elbow")]),t._v("相连。具体的关系如下：")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t'supercategory'"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" 'person'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t'id'"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t'name'"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" 'person'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t'keypoints'"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("'nose'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 'left_eye'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 'right_eye'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 'left_ear'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 'right_ear'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 'left_shoulder'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 'right_shoulder'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 'left_elbow'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 'right_elbow'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 'left_wrist'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 'right_wrist'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 'left_hip'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 'right_hip'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 'left_knee'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 'right_knee'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 'left_ankle'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 'right_ankle'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t'skeleton'"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("在"),s("code",[t._v("coco")]),t._v("的标注文件中，"),s("code",[t._v("keypoints")]),t._v("检测数据集的标注信息类别如以上介绍的17种，另外在"),s("code",[t._v("annotation")]),t._v("中增加了"),s("code",[t._v("num_keypoints")]),t._v("和"),s("code",[t._v("keypoints")]),t._v("字段,分别表示当前实例中包含了几个关键点和关键点的具体位置信息。"),s("code",[t._v("keypoints")]),t._v("是长度为"),s("code",[t._v("3k")]),t._v("的数组，其中"),s("code",[t._v("k")]),t._v("是关键点的类别数目，"),s("code",[t._v("coco")]),t._v("中"),s("code",[t._v("k=17")]),t._v("，"),s("code",[t._v("3")]),t._v("表示的是关键点的"),s("code",[t._v("(x,y,v)")]),t._v(","),s("code",[t._v("x,y")]),t._v("是关键点在原图上的坐标，"),s("code",[t._v("v")]),t._v("取"),s("code",[t._v("0,1,2")]),t._v(",定义的是关键点是否可见，其中"),s("code",[t._v("v=0")]),t._v("表示关键点没有标注，表示为"),s("code",[t._v("(x=0,y=0,v=0)")]),t._v(","),s("code",[t._v("v=1")]),t._v("表示标注但被遮挡，"),s("code",[t._v("v=2")]),t._v("表示标注且可见。")]),t._v(" "),s("p",[s("code",[t._v("coco")]),t._v("中只标注了图像中非拥挤场景中级以上大小的"),s("code",[t._v("human")]),t._v("的"),s("code",[t._v("keypoints")]),t._v(",训练/验证/测试数据包括超过"),s("code",[t._v("200000")]),t._v("张图像，"),s("code",[t._v("250000")]),t._v("个人体图像标注了关键点，训练/验证数据中有超过"),s("code",[t._v("150000")]),t._v("个人体图像，标注了超过"),s("code",[t._v("1 700 000")]),t._v("个关键点，"),s("code",[t._v("keypoints")]),t._v("标注文件的"),s("a",{attrs:{href:"https://cocodataset.org/#format-data",target:"_blank",rel:"noopener noreferrer"}},[t._v("字段如下"),s("OutboundLink")],1),t._v("：")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("annotations"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"id"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" int"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n     "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"image_id"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" int"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n     "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"category_id"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" int"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n     "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"segmentation"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RLE")]),t._v(" or "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("polygon"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n     "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"area"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" float"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n     "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"bbox"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("y"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("width"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("height"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n     "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"iscrowd"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" or "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"keypoints"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("x1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("y1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("v1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n     "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"num_keypoints"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" int\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\ncategories"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"id"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" int"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n     "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" str"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n     "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"supercategory"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" str"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"keypoints"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("str"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n     "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"skeleton"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("edge"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("h2",{attrs:{id:"_2-detectron2中实现的mask-r-cnn用于keypoints关键点检测"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-detectron2中实现的mask-r-cnn用于keypoints关键点检测"}},[t._v("#")]),t._v(" 2.Detectron2中实现的Mask R-CNN用于Keypoints关键点检测")]),t._v(" "),s("p",[t._v("前面介绍了"),s("code",[t._v("RPN")]),t._v("和"),s("code",[t._v("RoI Pooler")]),t._v(",通过"),s("a",{attrs:{href:"https://foobarweb.net/2022/08/15/6rpn/",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("RPN")]),s("OutboundLink")],1),t._v("网络可以找到可能包含物体的"),s("code",[t._v("proposal bounding boxes")]),t._v(","),s("a",{attrs:{href:"https://foobarweb.net/2022/08/13/5roipoolAndroialign/",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("RoI Pooler")]),s("OutboundLink")],1),t._v("可以对"),s("code",[t._v("proposal bounding boxes")]),t._v("的选定区域进行特征提取，以这两个技术为基础，"),s("code",[t._v("Mask R-CNN")]),t._v("可用来"),s("strong",[t._v("实例分割和关键点检测")]),t._v("。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://day-pic-1311699660.cos.ap-nanjing.myqcloud.com/image/2kpHead.jpg",alt:""}})]),t._v(" "),s("p",[s("code",[t._v("Mask R-CNN")]),t._v("中实现的"),s("code",[t._v("key points")]),t._v("检测如上图所示，使用的是"),s("code",[t._v("heatmap")]),t._v("概率图的方式，"),s("code",[t._v("keypoint_head")]),t._v("是"),s("code",[t._v("roi_head")]),t._v("中的一个分支，其输入的"),s("code",[t._v("features")]),t._v("是对"),s("code",[t._v("backbone")]),t._v("提取的图像特征"),s("code",[t._v("features")]),t._v("做"),s("code",[t._v("RoI Pooler")]),t._v("后得到的, 输入"),s("code",[t._v("keypoint_head")]),t._v("中的"),s("code",[t._v("proposals")]),t._v("已经没有了层级信息，在做"),s("code",[t._v("RoI Pooler")]),t._v("时有一个"),s("code",[t._v("assign_boxes_to_levels")]),t._v("的过程，其原理参考"),s("a",{attrs:{href:"https://arxiv.org/abs/1612.03144",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("FPN")]),s("OutboundLink")],1),t._v("论文中的方程1。 "),s("code",[t._v("keypoint_head")]),t._v("的结构如上图，由"),s("code",[t._v("8")]),t._v("个"),s("code",[t._v("CNN")]),t._v("组成，后跟"),s("code",[t._v("1")]),t._v("个"),s("code",[t._v("Transposed CNN")]),t._v("和"),s("code",[t._v("1")]),t._v("个向上"),s("code",[t._v("2x")]),t._v("的"),s("code",[t._v("interpolation")]),t._v("操作，用来输出"),s("code",[t._v("key points heatmap prediction")]),t._v("。若输入"),s("code",[t._v("keypoint_head")]),t._v("的"),s("code",[t._v("feature shape")]),t._v("为"),s("code",[t._v("NxCxHxW")]),t._v("，则输出"),s("code",[t._v("feature shape")]),t._v("为"),s("code",[t._v("NxKx(4*H)x(4*W)")]),t._v(",其中"),s("code",[t._v("K")]),t._v("表示的是实例中定义的"),s("code",[t._v("key point")]),t._v("总的类别，"),s("code",[t._v("N")]),t._v("表示的是"),s("code",[t._v("batch")]),t._v("中所有的"),s("code",[t._v("instance")]),t._v("个数，其和图片的对应关系，保存在"),s("code",[t._v("keypoint_head")]),t._v("的另一个输入"),s("code",[t._v("instances")]),t._v("中。")]),t._v(" "),s("p",[s("code",[t._v("keypoint_head")]),t._v("的最终预测输出"),s("code",[t._v("kp_heatmap pred")]),t._v("是"),s("code",[t._v("NxKx(4*H)x(4*W)")]),t._v("的特征图，"),s("strong",[t._v("在训练时")]),t._v("，根据"),s("code",[t._v("gt_keypoints")]),t._v("将其先转到"),s("code",[t._v("(4*H)x(4*W)")]),t._v("尺度上得坐标"),s("code",[t._v("(x,y)")]),t._v("，再取"),s("code",[t._v("y*kp_heatmap pred.cols+x")]),t._v("作为此点的目标值，在"),s("code",[t._v("K")]),t._v("个通道取有效点与"),s("code",[t._v("kp_heatmap pred")]),t._v("上对应"),s("code",[t._v("valid")]),t._v("通道的"),s("code",[t._v("(4*H)x(4*W)")]),t._v("概率图计算交叉熵损失函数"),s("code",[t._v("cross_entropy")]),t._v("。其原理是对每个"),s("code",[t._v("(4*H)x(4*W)")]),t._v("的概率图上的元素做分类，"),s("code",[t._v("target")]),t._v("就是当前类别"),s("code",[t._v("keypoint")]),t._v("在"),s("code",[t._v("heatmap")]),t._v("尺度上的位置。"),s("strong",[t._v("推理时")]),t._v("，对每个"),s("code",[t._v("instance")]),t._v("的"),s("code",[t._v("K")]),t._v("通道"),s("code",[t._v("(4*H)x(4*W)")]),t._v("的"),s("code",[t._v("heatmaps")]),t._v(",在每个通道"),s("code",[t._v("heatmap")]),t._v("上做"),s("code",[t._v("softmax")]),t._v("，求得概率最大的元素位置，即对应通道上"),s("code",[t._v("keypoint")]),t._v("的位置和评分，如此得到"),s("code",[t._v("N")]),t._v("个实例在"),s("code",[t._v("K")]),t._v("种关键点上预测的结果，"),s("code",[t._v("NxKx(x,y,score)")]),t._v("。最后，可以根据"),s("code",[t._v("score")]),t._v("的大小过滤掉"),s("code",[t._v("K")]),t._v("个通道上评分比较低的点。")]),t._v(" "),s("InArticleAdsense",{attrs:{"data-ad-client":"ca-pub-8685746128991385","data-ad-slot":"2974191661"}}),t._v(" "),s("h3",{attrs:{id:"参考资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),s("blockquote",[s("ul",[s("li",[s("a",{attrs:{href:"https://cocodataset.org/#format-data",target:"_blank",rel:"noopener noreferrer"}},[t._v("1.https://cocodataset.org/#format-data"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/facebookresearch/detectron2",target:"_blank",rel:"noopener noreferrer"}},[t._v("2.https://github.com/facebookresearch/detectron2"),s("OutboundLink")],1)])])])],1)}),[],!1,null,null,null);s.default=e.exports}}]);